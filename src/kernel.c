#include "io.h"
#include "convert.h"
#include "string.h"
#include "memory.h"
#include "mb.h"

void print_clippy();
char* get_user_input(char* buffer);

void main()
{
    extern long _start;
    char buffer[1024];
    uint8_t mac_address[6];

    uart_init();
    heap_init();

    print_clippy();
    uart_puts("Boot successful! \n");

    uart_puts("Firmware revision: ");
    uart_puts(utoa(get_vc_firmware_rev(), buffer, 10));

    get_board_mac_address(mac_address);
    uart_puts("\nMAC Address: ");
    for(uint8_t i = 0; i < 6; i++)
    {
        uart_puts(utoa(mac_address[i], buffer, 16));
        if(i != 5)
            uart_puts(":");
    }
    uart_puts("\n");
    
    uart_puts("\n");
    uart_puts("Started execution at 0x");
    uart_puts(ultoa((long)&_start, buffer, 16));

    for(;;)
    {
        uart_puts("\n\nPlease enter first operand\n");
        get_user_input(buffer);
        
        if(!strcmp(buffer, "clippy"))
        {
            print_clippy();
            continue;
        }

        int a = stoi(buffer);

        uart_puts("\nPlease enter second operand\n");
        int b = stoi(get_user_input(buffer));

        uart_puts("\n");
        uart_puts(itoa(a, buffer, 10));
        uart_puts(" * ");
        uart_puts(itoa(b, buffer, 10));
        uart_puts(" = ");
        uart_puts(itoa(a * b, buffer, 10));
    }
}

char* get_user_input(char* buffer)
{
    uart_puts("ðŸ“Ž "); 
    return uart_gets(buffer);
}

void print_clippy()
{
    uart_puts("    â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €   \n");
    uart_puts("â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â¢€â  â¡€â¢„â¢€â¢€â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â € â €\n");
    uart_puts("â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â¢€â¢â Œâ¡¢â¢‘â Œâ ¢â¢‘â¢â …â¡¢â¡€â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €\n");
    uart_puts("â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â¢€â£ â¢¤â£¤â£´â¢´â¡¦â£§â£Œâ „â €â €â €â €â €â ‘â¡°â ¨â¡Šâ „â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €  \n");
    uart_puts("â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â¢°â£Ÿâ£¯â£·â£»â£½â£¯â¢·â£Ÿâ¡†â €â €â €â €â €â €â â¢…â¢Šâ¢Œâ €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €\n");
    uart_puts("â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â ‰â¢˜â ¨â¡Šâ¢”â ˆâ ‰â â €â €â €â €â €â €â¡¤â¡¤â£…â£†â¡¢â â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €\n");
    uart_puts("â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â Šâ ”â Œâ ‚â €â €â €â €â €â €â €â €â ˜â¢Ÿâ£¿â¢½â£·â£»â¢·â¢¦â¡€â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €\n");
    uart_puts("â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â  â¢â£¨â¡´â£¤â£¢â¡ˆâ €â €â €â €â €â €â €â €â €â €â €â¢ â ©â¡Šâ¡›â¢Ÿâ£¿â£»â ‚â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €\n");
    uart_puts("â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â¢€â ˆâ£´â¢¿â¡½â£¯â¢¿â£žâ¡¿â£Žâ €â €â €â €â €â €â €â €â¢€â €â ‚â ‘â ˆâ „â €â ˆâ €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €\n");
    uart_puts("â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â „â  â£»â£½â¢¿â¡½â£¯â¢¿â£½â£»â €â¡€â €â €â €â €â  â£ˆâ£¤â¢¦â£¦â£‚â£â €â „â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €\n");
    uart_puts("â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â „â €â ™â£¾â£»â£½â£»â£½â¢·â ‹â €â €â €â €â €â ˆâ£´â£Ÿâ£¾â£»â£žâ£¿â£ºâ¢§â €â ˆâ¢€â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €\n");
    uart_puts("â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â ˆâ €â¡€â â â ‘â â â €â €â €â €â €â €â¡ˆâ£¾â£—â£¯â£·â£»â£—â£¿â£»â €â â¡€â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €\n");
    uart_puts("â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â â  â¡ â¢â €â ˆâ €â €â €â €â €â €â €â €â ±â£¯â¡·â£Ÿâ£¾â¡½â£žâ â¡€â â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €\n");
    uart_puts("â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â¡‘â¢Œâ¢‚â €â €â €â €â €â €â €â €â €â €â â ˆâ ™â ™â “â¢‰â ˆâ¢€â €â â €â €â  â  â¡€â €â €â €â €â €â €â €â €â €â €â €â €â €\n");
    uart_puts("â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â¡ªâ¢â ”â €â €â €â €â  â¡ â¡€â €â €â €â €â €â¡…â ¢â¡â €â €â €â €â €â¢€â¢Œâ ªâ ¨â ‚â €â €â €â €â €â €â €â €â €â €â €â €â €\n");
    uart_puts("â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â¡ªâ¢â Œâ €â €â €â €â¡‘â¡â¢Œâ €â €â €â €â â¢Œâ ªâ¡€â €â €â €â €â  â¡‘â¢„â •â â €â €â €â €â €â €â €â €â €â €â €â €â €â €\n");
    uart_puts("â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â¡ªâ¢â ¡â €â €â €â €â Œâ¡Œâ ¢â €â €â €â €â ˆâ¡¢â¢‘â „â €â €â €â  â¡‘â¢Œâ ‚â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €\n");
    uart_puts("â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â¢Œâ ¢â¡¡â €â €â €â €â ¡â¡Šâ¢Œâ €â €â €â €â €â¡ªâ¢â Œâ €â €â €â¢Œâ¢Œâ ¢â â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €\n");
    uart_puts("â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â ¢â¡‘â¡â¡€â €â €â €â ¡â¢Šâ ”â¡€â €â €â €â €â¢Œâ ¢â¡‘â €â €â €â¡¢â ¢â ¡â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €\n");
    uart_puts("â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â¢ˆâ ¢â¡‘â¡€â €â €â €â ˆâ¡¢â¢‘â „â €â €â €â €â¢â …â¡Šâ „â €â €â¡Šâ¢Œâ¢Šâ €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €\n");
    uart_puts("â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â  â¢‘â ”â¡â¡€â €â €â €â¢Œâ¢‚â ªâ €â €â €â €â¢â …â¡ªâ €â €â €â¢Œâ ¢â ¡â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €\n");
    uart_puts("â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â € â €â €â ¡â¡Šâ ”â¢„â €â €â €â €â ªâ ¨â¡Šâ¢„â¢€â¢€â ¢â¡‘â¡â â €â €â  â¡‘â …â …â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €\n");
    uart_puts("â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â â Œâ¡ªâ¢â „â €â €â €â ˆâ ˆâ ¢â ¡â ¢â¡¡â¢‘â â â €â €â €â €â¡ªâ ¨â¡‚â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €\n");
    uart_puts("â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â € â €â €â €â €â ¨â¢‚â¢…â ¢â €â €â €â €â €â €â â â €â €â €â €â €â €â €â €â¢Œâ¢Œâ ¢â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €\n");
    uart_puts("â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â ¡â¢‚â •â¡¡â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â¢…â ¢â¡¡â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €\n");
    uart_puts("â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â â ¡â ¢â¡¡â €â €â €â €â €â €â €â €â €â €â €â €â €â ¨â¡‚â¢•â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €\n");
    uart_puts("â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â € â €â €â €â €â €â €â €â ˆâ¢Šâ ”â¡‘â¢„â €â €â €â €â €â €â €â €â €â €â¢„â £â ¨â¡‚â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €\n");
    uart_puts("â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â € â €â €â €â €â €â Šâ¢”â ¡â¡¡â¡â¡€â¢€â €â €â¡€â¢€â Œâ¢Œâ ¢â ¡â¡ƒâ €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €\n");
    uart_puts("â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â ‘â¡â Œâ¡Œâ¡‚â¡Šâ¡¢â¢Šâ ”â¢Œâ ¢â ‘â â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €\n");
    uart_puts("â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â ˆâ €â ˆâ ‚â ˆâ ‚â ˆâ €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â € \n");
    uart_puts("â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â € â €â € â €â €â €â €â € â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €â €\n");

}